<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aperitivo Vigilia di Natale</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=DM+Serif+Text:wght@400;600;700&family=Roboto:wght@400;700&display=swap');
    body { margin: 0; padding: 0; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
const { useState, useEffect } = React;

// Icone SVG
const Wine = ({ size = 24, strokeWidth = 2, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>
    <path d="M8 22h8" /><path d="M7 10h10" /><path d="M12 15v7" /><path d="M12 15a5 5 0 0 0 5-5c0-2-.5-4-2-8H9c-1.5 4-2 6-2 8a5 5 0 0 0 5 5Z" />
  </svg>
);

const Info = ({ size = 24, strokeWidth = 2, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>
    <circle cx="12" cy="12" r="10" /><path d="M12 16v-4" /><path d="M12 8h.01" />
  </svg>
);

const Sparkles = ({ size = 24, strokeWidth = 2, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>
    <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" /><path d="M5 3v4" /><path d="M19 17v4" /><path d="M3 5h4" /><path d="M17 19h4" />
  </svg>
);

const Calendar = ({ size = 24 }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" />
  </svg>
);

const MapPin = ({ size = 24 }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" /><circle cx="12" cy="10" r="3" />
  </svg>
);

const Instagram = ({ size = 24 }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <rect x="2" y="2" width="20" height="20" rx="5" ry="5" /><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" /><line x1="17.5" y1="6.5" x2="17.51" y2="6.5" />
  </svg>
);

const Facebook = ({ size = 24 }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z" />
  </svg>
);

// Storage mock
const mockStorage = {
  data: {},
  async get(key) { 
    return this.data[key] ? { key, value: this.data[key] } : null; 
  },
  async set(key, value) { 
    this.data[key] = value; 
    return { key, value }; 
  },
  async list(prefix) { 
    return { keys: Object.keys(this.data).filter(k => k.startsWith(prefix || '')) }; 
  }
};

if (!window.storage) window.storage = mockStorage;

const App = () => {
  const [view, setView] = useState('home');
  const [tables, setTables] = useState([]);

  useEffect(() => { 
    loadTables(); 
  }, []);

  const loadTables = async () => {
    try {
      console.log('Caricamento tavoli da Google Sheets...');
      const response = await fetch('https://script.google.com/macros/s/AKfycbyFP3ACqDbGzAIA0Uq6RFhJriw0VgDZRivR-kMivlbuyt2mjqfCeJugqbgDgjAlF3HhhA/exec');
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const tablesFromSheets = await response.json();
      console.log('Tavoli caricati:', tablesFromSheets);
      setTables(tablesFromSheets);
    } catch (error) {
      console.error('Errore caricamento tavoli:', error);
      setTables([]);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-b from-red-950 via-red-900 to-red-950 text-white">
      {view === 'home' && <HomeScreen setView={setView} />}
      {view === 'booking' && <BookingScreen setView={setView} tables={tables} loadTables={loadTables} />}
      {view === 'info' && <InfoScreen setView={setView} />}
      {view === 'social' && <SocialScreen setView={setView} />}
    </div>
  );
};

const HomeScreen = ({ setView }) => (
  <div className="h-screen flex flex-col items-center justify-center p-3 text-center">
    <Sparkles size={48} className="mb-4 mx-auto" strokeWidth={1.5} />
    <h1 className="text-3xl mb-2 tracking-wide" style={{ fontFamily: 'Bodoni MT, Georgia, serif' }}>
      Aperitivo Vigilia di Natale
    </h1>
    <p className="mb-6 opacity-80 text-sm max-w-xs" style={{ fontFamily: 'Roboto, sans-serif' }}>
      Un evento speciale per celebrare insieme
    </p>
    <div className="flex flex-col gap-2 w-full max-w-xs">
      <button onClick={() => setView('booking')} className="w-full bg-white text-black py-3 rounded-lg font-bold hover:bg-opacity-90 transition flex items-center justify-center gap-2 text-sm shadow-lg" style={{ fontFamily: 'Roboto, sans-serif' }}>
        <Wine size={18} />Prenota Tavolo
      </button>
      <button onClick={() => setView('info')} className="w-full bg-transparent border-2 border-white py-3 rounded-lg font-bold hover:bg-white hover:text-black transition flex items-center justify-center gap-2 text-sm" style={{ fontFamily: 'Roboto, sans-serif' }}>
        <Info size={18} />Dettagli Evento
      </button>
      <button onClick={() => setView('social')} className="w-full bg-transparent border-2 border-white py-3 rounded-lg font-bold hover:bg-white hover:text-black transition flex items-center justify-center gap-2 text-sm" style={{ fontFamily: 'Roboto, sans-serif' }}>
        <Instagram size={18} />Seguici
      </button>
    </div>
  </div>
);

const BookingScreen = ({ setView, tables, loadTables }) => {
  const [formData, setFormData] = useState({ nome: '', cognome: '', telefono: '', email: '', tavolo: '' });
  const [status, setStatus] = useState('');
  const [showSuccess, setShowSuccess] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!formData.tavolo) {
      setStatus('Seleziona un tavolo');
      return;
    }
    setStatus('invio');

    const tableData = tables.find(t => t.numero === formData.tavolo);
    const dataInvio = {
      nome: formData.nome,
      cognome: formData.cognome,
      telefono: formData.telefono,
      email: formData.email,
      tavolo: formData.tavolo,
      prezzo: tableData?.prezzo || '',
      persone: tableData?.persone || ''
    };

    try {
      const response = await fetch('https://script.google.com/macros/s/AKfycbyFP3ACqDbGzAIA0Uq6RFhJriw0VgDZRivR-kMivlbuyt2mjqfCeJugqbgDgjAlF3HhhA/exec', {
        method: 'POST',
        body: JSON.stringify(dataInvio)
      });

      const result = await response.json();
      
      if (result.success) {
        setShowSuccess(true);
        setFormData({ nome: '', cognome: '', telefono: '', email: '', tavolo: '' });
        await loadTables();
      } else {
        setStatus('Errore: ' + (result.message || 'Riprova'));
      }
    } catch (error) {
      setStatus('Errore di connessione');
    }
  };

  const availableTables = tables.filter(t => t.disponibile);

  if (showSuccess) {
    return (
      <div className="h-screen flex items-center justify-center p-3">
        <div className="max-w-md bg-white bg-opacity-10 p-6 rounded-lg text-center">
          <div className="text-5xl mb-4">üéâ</div>
          <h2 className="text-2xl mb-3" style={{ fontFamily: 'Bodoni MT, Georgia, serif' }}>Prenotazione Confermata!</h2>
          <p className="mb-4 opacity-90 text-sm">Ti abbiamo inviato una email di conferma.</p>
          <p className="mb-6 opacity-75 text-xs">Ricorda: il tavolo va saldato entro il 20 dicembre.</p>
          <button onClick={() => setView('home')} className="bg-white text-black px-6 py-2 rounded-lg font-bold hover:bg-opacity-90 transition text-sm" style={{ fontFamily: 'Roboto, sans-serif' }}>Torna alla Home</button>
        </div>
      </div>
    );
  }

  return (
    <div className="h-screen overflow-y-auto p-3">
      <button onClick={() => setView('home')} className="mb-3 text-white underline text-sm">‚Üê Torna alla home</button>
      <div className="max-w-md mx-auto bg-white bg-opacity-10 p-4 rounded-lg">
        <h2 className="text-2xl mb-4 text-center" style={{ fontFamily: 'Bodoni MT, Georgia, serif' }}>Prenota il tuo tavolo</h2>
        <form onSubmit={handleSubmit} className="space-y-3">
          <input type="text" placeholder="Nome" value={formData.nome} onChange={e => setFormData({...formData, nome: e.target.value})} className="w-full px-3 py-2 rounded text-black text-sm" required style={{ fontFamily: 'Roboto, sans-serif' }} />
          <input type="text" placeholder="Cognome" value={formData.cognome} onChange={e => setFormData({...formData, cognome: e.target.value})} className="w-full px-3 py-2 rounded text-black text-sm" required style={{ fontFamily: 'Roboto, sans-serif' }} />
          <input type="tel" placeholder="Telefono" value={formData.telefono} onChange={e => setFormData({...formData, telefono: e.target.value})} className="w-full px-3 py-2 rounded text-black text-sm" required style={{ fontFamily: 'Roboto, sans-serif' }} />
          <input type="email" placeholder="Email" value={formData.email} onChange={e => setFormData({...formData, email: e.target.value})} className="w-full px-3 py-2 rounded text-black text-sm" required style={{ fontFamily: 'Roboto, sans-serif' }} />
          
          <div>
            <label className="block mb-2 font-semibold text-sm">Seleziona tavolo:</label>
            <div className="grid grid-cols-2 gap-2 max-h-60 overflow-y-auto">
              {availableTables.map(table => (
                <button type="button" key={table.numero} onClick={() => setFormData({...formData, tavolo: table.numero})} className={`p-2 rounded text-xs border-2 transition ${formData.tavolo === table.numero ? 'bg-white text-black border-white' : 'bg-transparent border-white text-white hover:bg-white hover:bg-opacity-20'}`} style={{ fontFamily: 'Roboto, sans-serif' }}>
                  <div className="font-bold">Tavolo {table.numero}</div>
                  <div className="text-xs">{table.persone} persone</div>
                  <div className="font-semibold">{table.prezzo}</div>
                </button>
              ))}
            </div>
          </div>

          <button type="submit" disabled={status === 'invio'} className="w-full bg-white text-black py-3 rounded-lg font-bold hover:bg-opacity-90 transition disabled:opacity-50 text-sm shadow-lg" style={{ fontFamily: 'Roboto, sans-serif' }}>
            {status === 'invio' ? 'Invio in corso...' : 'Conferma Prenotazione'}
          </button>
          {status && status !== 'invio' && <p className="text-center text-sm mt-2">{status}</p>}
        </form>
      </div>
    </div>
  );
};

const InfoScreen = ({ setView }) => {
  const [showMenu, setShowMenu] = useState(false);
  const [showPoster, setShowPoster] = useState(false);

  const posterBase64 = `iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==`;
  
  return (
    <div className="h-screen overflow-y-auto p-3">
      <button onClick={() => setView('home')} className="mb-3 text-white underline text-sm">‚Üê Torna alla home</button>
      <div className="max-w-md mx-auto bg-white bg-opacity-10 p-4 rounded-lg">
        <h2 className="text-2xl mb-4 text-center" style={{ fontFamily: 'Bodoni MT, Georgia, serif' }}>Info Utili</h2>
        
        <div className="flex flex-col gap-2 mb-4">
          <button onClick={() => setShowMenu(!showMenu)} className="w-full bg-white text-black py-3 rounded-lg font-bold hover:bg-opacity-90 transition text-sm shadow-lg" style={{ fontFamily: 'Roboto, sans-serif' }}>
            Vedi men√π
          </button>
          <button onClick={() => window.location.href = 'tel:+39098424945'} className="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-500 transition text-sm shadow-lg" style={{ fontFamily: 'Roboto, sans-serif' }}>
            Chiama ora
          </button>
          <button onClick={() => setShowPoster(!showPoster)} className="w-full bg-red-600 text-white py-3 rounded-lg font-bold hover:bg-red-500 transition text-sm shadow-lg" style={{ fontFamily: 'Roboto, sans-serif' }}>
            Locandina evento
          </button>
        </div>

        {showPoster && (
          <div className="bg-white bg-opacity-95 p-4 rounded-lg mb-4 shadow-xl">
            <h3 className="text-lg font-bold text-black mb-3 text-center" style={{ fontFamily: 'DM Serif Text, serif' }}>Locandina</h3>
            <img src={`data:image/png;base64,${posterBase64}`} alt="Locandina evento" className="w-full rounded-lg" />
          </div>
        )}

        {showMenu && (
          <div className="bg-white bg-opacity-95 p-4 rounded-lg mb-4 shadow-xl">
            <h3 className="text-lg font-bold text-black mb-3 text-center" style={{ fontFamily: 'DM Serif Text, serif' }}>Il nostro men√π</h3>
            <ul className="text-black space-y-2 text-sm" style={{ fontFamily: 'Roboto, sans-serif' }}>
              <li>‚Ä¢ Cuddruriaddru</li>
              <li>‚Ä¢ Caprino</li>
              <li>‚Ä¢ Capocollo di suino nero DOP</li>
              <li>‚Ä¢ Ricottina</li>
              <li>‚Ä¢ Baguette con salame spagnolo</li>
              <li>‚Ä¢ Mini pitta con mortadella IGP e provolone piccante</li>
              <li>‚Ä¢ Olive di cerignola</li>
            </ul>
          </div>
        )}

        <div className="space-y-4">
          <div className="flex items-start gap-2">
            <Calendar size={20} className="mt-1 flex-shrink-0" />
            <div>
              <h3 className="font-bold text-base mb-1">Data e Orario</h3>
              <p className="opacity-90 text-sm">24 Dicembre 2025, ore 12:00</p>
            </div>
          </div>
          <div className="flex items-start gap-2">
            <MapPin size={20} className="mt-1 flex-shrink-0" />
            <div>
              <h3 className="font-bold text-base mb-1">Luogo</h3>
              <a href="https://www.google.com/maps/search/?api=1&query=C.so+Mazzini+3b,+Cosenza+(CS)+87100" target="_blank" rel="noopener noreferrer" className="opacity-90 text-sm underline hover:opacity-100 transition">
                C.so Mazzini 3b, Cosenza (CS) 87100
              </a>
            </div>
          </div>
          <div className="border-t border-white border-opacity-30 pt-3">
            <h3 className="font-bold text-base mb-2">Importante</h3>
            <ul className="space-y-1.5 opacity-90 text-sm">
              <li>‚Ä¢ Il tavolo va saldato entro il 20 dicembre</li>
              <li>‚Ä¢ Dopo il 20 dicembre la prenotazione decade automaticamente</li>
              <li>‚Ä¢ Riceverai una email di conferma con tutti i dettagli</li>
              <li>‚Ä¢ Per informazioni: recruitingdelizie@gmail.com</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  );
};

const SocialScreen = ({ setView }) => (
  <div className="h-screen overflow-y-auto p-3">
    <button onClick={() => setView('home')} className="mb-3 text-white underline text-sm">‚Üê Torna alla home</button>
    <div className="max-w-md mx-auto bg-white bg-opacity-10 p-4 rounded-lg text-center">
      <h2 className="text-2xl mb-6" style={{ fontFamily: 'Bodoni MT, Georgia, serif' }}>Seguici</h2>
      <div className="space-y-3">
        <a href="https://instagram.com/delizie_pasticceria" target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 bg-pink-600 py-3 rounded-lg font-semibold hover:bg-pink-500 transition text-sm">
          <Instagram size={20} />Instagram
        </a>
        <a href="https://www.facebook.com/delizie.cs" target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 bg-blue-600 py-3 rounded-lg font-semibold hover:bg-blue-500 transition text-sm">
          <Facebook size={20} />Facebook
        </a>
      </div>
      <p className="mt-6 opacity-75 text-xs">Resta aggiornato su eventi e novit√†!</p>
    </div>
  </div>
);

ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
