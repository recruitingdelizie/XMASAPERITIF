<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aperitivo Vigilia di Natale</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=DM+Serif+Text:wght@400;600;700&family=Roboto:wght@400;700&display=swap');
    body { margin: 0; padding: 0; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel"> const { useState, useEffect } = React;

// Icone SVG
const Wine = ({ size = 24, strokeWidth = 2, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>
    <path d="M8 22h8" /><path d="M7 10h10" /><path d="M12 15v7" /><path d="M12 15a5 5 0 0 0 5-5c0-2-.5-4-2-8H9c-1.5 4-2 6-2 8a5 5 0 0 0 5 5Z" />
  </svg>
);

const Info = ({ size = 24, strokeWidth = 2, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>
    <circle cx="12" cy="12" r="10" /><path d="M12 16v-4" /><path d="M12 8h.01" />
  </svg>
);

const Sparkles = ({ size = 24, strokeWidth = 2, className = "" }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>
    <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" /><path d="M5 3v4" /><path d="M19 17v4" /><path d="M3 5h4" /><path d="M17 19h4" />
  </svg>
);

const Calendar = ({ size = 24 }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" />
  </svg>
);

const MapPin = ({ size = 24 }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" /><circle cx="12" cy="10" r="3" />
  </svg>
);

const Instagram = ({ size = 24 }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <rect x="2" y="2" width="20" height="20" rx="5" ry="5" /><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z" /><line x1="17.5" y1="6.5" x2="17.51" y2="6.5" />
  </svg>
);

const Facebook = ({ size = 24 }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z" />
  </svg>
);

const Loader = ({ size = 24 }) => (
  <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="animate-spin">
    <line x1="12" y1="2" x2="12" y2="6" /><line x1="12" y1="18" x2="12" y2="22" /><line x1="4.93" y1="4.93" x2="7.76" y2="7.76" /><line x1="16.24" y1="16.24" x2="19.07" y2="19.07" /><line x1="2" y1="12" x2="6" y2="12" /><line x1="18" y1="12" x2="22" y2="12" /><line x1="4.93" y1="19.07" x2="7.76" y2="16.24" /><line x1="16.24" y1="7.76" x2="19.07" y2="4.93" />
  </svg>
);

const Aperitivo = () => {
  const [view, setView] = useState('home');
  const [showPopup, setShowPopup] = useState(false);
  const [partySize, setPartySize] = useState(2);
  const [nome, setNome] = useState('');
  const [cognome, setCognome] = useState('');
  const [email, setEmail] = useState('');
  const [consenso, setConsenso] = useState(false);
  const [confermaOk, setConfermaOk] = useState(false);
  const [errors, setErrors] = useState({});
  const [isSubmitting, setIsSubmitting] = useState(false);

  const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwcuXo5LXZWF-kV5ZSqRcqU_B5bh_xX9g35UvP41wIPy2y6rEMcXMzq0_FpVe8R7dJGKg/exec';

  const validate = () => {
    const newErrors = {};
    if (!nome.trim()) newErrors.nome = 'Il nome è obbligatorio';
    if (!cognome.trim()) newErrors.cognome = 'Il cognome è obbligatorio';
    if (!email.trim()) newErrors.email = 'L\'email è obbligatoria';
    else if (!/^\S+@\S+\.\S+$/.test(email)) newErrors.email = 'Email non valida';
    if (!consenso) newErrors.consenso = 'Devi accettare il trattamento dei dati';
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleConfirm = async () => {
    // Previeni invii multipli
    if (isSubmitting) {
      console.log('Invio già in corso, richiesta ignorata');
      return;
    }

    if (!validate()) return;

    setIsSubmitting(true); // Blocca ulteriori click

    try {
      const params = new URLSearchParams({
        nome: nome.trim(),
        cognome: cognome.trim(),
        email: email.trim(),
        numero_persone: partySize.toString(),
        consenso: 'si'
      });

      const response = await fetch(SCRIPT_URL + '?' + params.toString(), { method: 'GET' });
      const result = await response.json();

      if (result.success) {
        setConfermaOk(true);
        setShowPopup(false);
        setTimeout(() => {
          setView('home');
          setNome('');
          setCognome('');
          setEmail('');
          setPartySize(2);
          setConsenso(false);
          setConfermaOk(false);
          setIsSubmitting(false); // Reset dopo il completamento
        }, 5000);
      } else {
        alert(result.message || 'Si è verificato un errore. Riprova.');
        setIsSubmitting(false); // Reset in caso di errore
      }
    } catch (error) {
      console.error('Errore durante l\'invio:', error);
      alert('Errore di connessione. Riprova.');
      setIsSubmitting(false); // Reset in caso di errore
    }
  };

  const handleOpenForm = () => {
    setShowPopup(true);
    setErrors({});
    setNome('');
    setCognome('');
    setEmail('');
    setPartySize(2);
    setConsenso(false);
    setIsSubmitting(false); // Reset quando si apre il form
  };

  return (
    <div className="min-h-screen" style={{
      background: 'linear-gradient(135deg, #1a472a 0%, #2d5a3d 50%, #1a472a 100%)',
      color: 'white',
      fontFamily: 'Roboto, sans-serif'
    }}>
      {view === 'home' && <HomeScreen setView={setView} handleOpenForm={handleOpenForm} />}
      {view === 'info' && <InfoScreen setView={setView} />}
      {view === 'prenota' && !confermaOk && (
        <BookingForm
          partySize={partySize}
          setPartySize={setPartySize}
          handleOpenForm={handleOpenForm}
          setView={setView}
        />
      )}
      {confermaOk && <ConfermaScreen setView={setView} />}
      {view === 'social' && <SocialScreen setView={setView} />}

      {showPopup && (
        <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-3">
          <div className="bg-white bg-opacity-95 rounded-lg p-4 max-w-sm w-full max-h-[90vh] overflow-y-auto">
            <h3 className="text-xl mb-3 text-green-800" style={{ fontFamily: 'DM Serif Text, serif' }}>Completa la tua Prenotazione</h3>
            <div className="space-y-3">
              <div>
                <label className="block text-sm font-semibold mb-1 text-gray-700">Nome</label>
                <input type="text" value={nome} onChange={(e) => setNome(e.target.value)} className="w-full p-2 border border-gray-300 rounded text-gray-800 text-sm" />
                {errors.nome && <p className="text-red-600 text-xs mt-1">{errors.nome}</p>}
              </div>
              <div>
                <label className="block text-sm font-semibold mb-1 text-gray-700">Cognome</label>
                <input type="text" value={cognome} onChange={(e) => setCognome(e.target.value)} className="w-full p-2 border border-gray-300 rounded text-gray-800 text-sm" />
                {errors.cognome && <p className="text-red-600 text-xs mt-1">{errors.cognome}</p>}
              </div>
              <div>
                <label className="block text-sm font-semibold mb-1 text-gray-700">Email</label>
                <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} className="w-full p-2 border border-gray-300 rounded text-gray-800 text-sm" />
                {errors.email && <p className="text-red-600 text-xs mt-1">{errors.email}</p>}
              </div>
              <div>
                <label className="block text-sm font-semibold mb-1 text-gray-700">Numero di Persone: {partySize}</label>
                <input type="range" min="1" max="10" value={partySize} onChange={(e) => setPartySize(parseInt(e.target.value))} className="w-full" />
              </div>
              <div className="flex items-start gap-2">
                <input type="checkbox" id="consenso" checked={consenso} onChange={(e) => setConsenso(e.target.checked)} className="mt-1" />
                <label htmlFor="consenso" className="text-xs text-gray-700">Accetto il trattamento dei dati personali per la gestione della prenotazione</label>
              </div>
              {errors.consenso && <p className="text-red-600 text-xs">{errors.consenso}</p>}
              <div className="flex gap-2 pt-2">
                <button 
                  onClick={() => {
                    setShowPopup(false);
                    setIsSubmitting(false);
                  }} 
                  className="flex-1 bg-gray-400 py-2 rounded font-semibold hover:bg-gray-500 transition text-sm"
                  disabled={isSubmitting}
                >
                  Annulla
                </button>
                <button 
                  onClick={handleConfirm} 
                  className="flex-1 bg-green-700 py-2 rounded font-semibold hover:bg-green-600 transition text-sm disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                  disabled={isSubmitting}
                >
                  {isSubmitting ? (
                    <>
                      <Loader size={16} />
                      <span>Invio...</span>
                    </>
                  ) : (
                    'Conferma prenotazione'
                  )}
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

const HomeScreen = ({ setView, handleOpenForm }) => (
  <div className="h-screen flex flex-col items-center justify-center p-3 text-center">
    <div className="mb-6">
      <Wine size={64} className="mx-auto mb-3" strokeWidth={1.5} />
      <h1 className="text-4xl mb-2" style={{ fontFamily: 'DM Serif Text, serif', fontWeight: 600 }}>Aperitivo di Natale</h1>
      <p className="text-lg opacity-90 mb-1">Vigilia di Natale</p>
      <p className="text-sm opacity-75">24 Dicembre 2025 • ore 12:00</p>
    </div>
    <div className="space-y-3 w-full max-w-xs">
      <button onClick={handleOpenForm} className="w-full bg-white text-green-800 py-4 rounded-lg font-bold text-base hover:bg-opacity-90 transition shadow-lg">Prenota ora</button>
      <button onClick={() => setView('info')} className="w-full bg-white bg-opacity-20 py-3 rounded-lg font-semibold text-sm hover:bg-opacity-30 transition">Maggiori informazioni</button>
      <button onClick={() => setView('social')} className="w-full bg-white bg-opacity-20 py-3 rounded-lg font-semibold text-sm hover:bg-opacity-30 transition">Seguici sui social</button>
    </div>
  </div>
);

const BookingForm = ({ partySize, setPartySize, handleOpenForm, setView }) => (
  <div className="h-screen overflow-y-auto p-3">
    <button onClick={() => setView('home')} className="mb-3 text-white underline text-sm">← Torna alla home</button>
    <div className="max-w-md mx-auto bg-white bg-opacity-10 p-4 rounded-lg">
      <h2 className="text-2xl mb-4 text-center" style={{ fontFamily: 'DM Serif Text, serif' }}>Prenota il tuo posto</h2>
      <div className="mb-4">
        <label className="block text-sm font-semibold mb-2">Numero di Persone</label>
        <div className="flex items-center gap-3">
          <button onClick={() => setPartySize(Math.max(1, partySize - 1))} className="bg-white bg-opacity-30 w-10 h-10 rounded-full font-bold text-lg hover:bg-opacity-40 transition">-</button>
          <span className="text-3xl font-bold flex-1 text-center">{partySize}</span>
          <button onClick={() => setPartySize(Math.min(10, partySize + 1))} className="bg-white bg-opacity-30 w-10 h-10 rounded-full font-bold text-lg hover:bg-opacity-40 transition">+</button>
        </div>
        <p className="text-xs opacity-75 mt-2 text-center">Massimo 10 persone per prenotazione</p>
      </div>
      <button onClick={handleOpenForm} className="w-full bg-white text-green-800 py-3 rounded-lg font-bold hover:bg-opacity-90 transition text-sm">Continua con la prenotazione</button>
    </div>
  </div>
);

const InfoScreen = ({ setView }) => (
  <div className="h-screen overflow-y-auto p-3">
    <button onClick={() => setView('home')} className="mb-3 text-white underline text-sm">← Torna alla home</button>
    <div className="max-w-md mx-auto bg-white bg-opacity-10 p-4 rounded-lg">
      <div className="text-center mb-4">
        <Sparkles size={48} className="mx-auto mb-2" />
        <h2 className="text-2xl" style={{ fontFamily: 'DM Serif Text, serif' }}>Un'occasione speciale</h2>
      </div>
      <div className="space-y-3 text-sm opacity-90 leading-relaxed">
        <p>Unisciti a noi per un aperitivo esclusivo nella magica atmosfera della Vigilia di Natale.</p>
        <p>Un momento di convivialità e festa con i migliori vini e stuzzichini della tradizione.</p>
        <div className="bg-white bg-opacity-10 p-3 rounded-lg mt-4">
          <h3 className="font-bold mb-2 text-base">Nel menù</h3>
          <ul className="space-y-1.5 text-sm">
            <li>• Selezione di vini pregiati</li>
            <li>• Stuzzichini gourmet</li>
            <li>• Dolci natalizi</li>
            <li>• Specialità della casa</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
);

const ConfermaScreen = ({ setView }) => {
  useEffect(() => {
    const timer = setTimeout(() => setView('home'), 5000);
    return () => clearTimeout(timer);
  }, [setView]);

  return (
    <div className="h-screen flex items-center justify-center p-3">
      <div className="max-w-md bg-white bg-opacity-10 p-6 rounded-lg text-center">
        <div className="mb-4">
          <div className="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-3">
            <svg className="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
            </svg>
          </div>
          <h2 className="text-2xl font-bold mb-2" style={{ fontFamily: 'DM Serif Text, serif' }}>Prenotazione Confermata!</h2>
          <p className="opacity-90 mb-4 text-sm">Ti aspettiamo il 24 Dicembre!</p>
        </div>

        {window.innerWidth < 640 && (
          <div className="mb-4 bg-yellow-500 bg-opacity-20 border border-yellow-500 border-opacity-40 rounded-lg p-3 text-left">
            <div className="flex items-start gap-2">
              <Info size={20} className="flex-shrink-0 mt-0.5 text-yellow-300" />
              <p className="text-xs text-yellow-100">
                Riceverai a breve un'email di conferma. <strong>Controlla anche la cartella spam!</strong>
              </p>
            </div>
          </div>
        )}

        <div className="space-y-4">
          <div className="flex items-start gap-2">
            <Calendar size={20} className="mt-1 flex-shrink-0" />
            <div>
              <h3 className="font-bold text-base mb-1">Data e Orario</h3>
              <p className="opacity-90 text-sm">24 Dicembre 2025, ore 12:00</p>
            </div>
          </div>
          <div className="flex items-start gap-2">
            <MapPin size={20} className="mt-1 flex-shrink-0" />
            <div>
              <h3 className="font-bold text-base mb-1">Luogo</h3>
              <a href="https://www.google.com/maps/search/?api=1&query=C.so+Mazzini+3b,+Cosenza+(CS)+87100" target="_blank" rel="noopener noreferrer" className="opacity-90 text-sm underline hover:opacity-100 transition">
    C.so Mazzini 3b, Cosenza (CS) 87100
  </a>
            </div>
          </div>
          <div className="border-t border-white border-opacity-30 pt-3">
            <h3 className="font-bold text-base mb-2">Importante</h3>
            <ul className="space-y-1.5 opacity-90 text-sm">
              <li>• Riceverai una email di conferma con tutti i dettagli</li>
              <li>• Per informazioni: recruitingdelizie@gmail.com</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  );
};

const SocialScreen = ({ setView }) => (
  <div className="h-screen overflow-y-auto p-3">
    <button onClick={() => setView('home')} className="mb-3 text-white underline text-sm">← Torna alla home</button>
    <div className="max-w-md mx-auto bg-white bg-opacity-10 p-4 rounded-lg text-center">
      <h2 className="text-2xl mb-6" style={{ fontFamily: 'Bodoni MT, Georgia, serif' }}>Seguici</h2>
      <div className="space-y-3">
        <a href="https://instagram.com/delizie_pasticceria" target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 bg-pink-600 py-3 rounded-lg font-semibold hover:bg-pink-500 transition text-sm">
          <Instagram size={20} />Instagram
        </a>
        <a href="https://www.facebook.com/delizie.cs" target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 bg-blue-600 py-3 rounded-lg font-semibold hover:bg-blue-500 transition text-sm">
          <Facebook size={20} />Facebook
        </a>
      </div>
      <p className="mt-6 opacity-75 text-xs">Resta aggiornato su eventi e novità!</p>
    </div>
  </div>
);

const App = () => <Aperitivo />;

ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
